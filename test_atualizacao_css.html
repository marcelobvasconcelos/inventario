<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Teste de Atualização de CSS</title>
    <link rel="stylesheet" id="tema-css" href="css/tema_padrao.css">
    <style>
        .header {
            background: var(--cor-primaria, #124a80);
            color: var(--cor-texto-claro, white);
            padding: 1rem;
            text-align: center;
            margin-bottom: 20px;
        }
        .btn {
            background-color: var(--cor-secundaria, #28a745);
            color: var(--cor-texto-claro, white);
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background-color: var(--cor-secundaria-escura, #218838);
        }
        .teste-cor {
            width: 50px;
            height: 50px;
            display: inline-block;
            margin: 5px;
            border: 1px solid black;
        }
        .cor-primaria { background-color: var(--cor-primaria, #124a80); }
        .cor-secundaria { background-color: var(--cor-secundaria, #28a745); }
    </style>
</head>
<body>
    <div class="header">
        <h1>Teste de Atualização de CSS</h1>
    </div>
    
    <h2>Teste de aplicação de temas</h2>
    <p>Tema atual: <strong id="tema-atual">padrao</strong></p>
    
    <div>
        <h3>Cores do tema atual:</h3>
        <div class="teste-cor cor-primaria"></div>
        <div class="teste-cor cor-secundaria"></div>
    </div>
    
    <div style="margin-top: 20px;">
        <h3>Método 1: Atualizar href do link existente</h3>
        <button onclick="metodo1('padrao')">Padrão</button>
        <button onclick="metodo1('azul')">Azul</button>
        <button onclick="metodo1('verde')">Verde</button>
        <button onclick="metodo1('roxo')">Roxo</button>
    </div>
    
    <div style="margin-top: 20px;">
        <h3>Método 2: Remover e adicionar novo link</h3>
        <button onclick="metodo2('padrao')">Padrão</button>
        <button onclick="metodo2('azul')">Azul</button>
        <button onclick="metodo2('verde')">Verde</button>
        <button onclick="metodo2('roxo')">Roxo</button>
    </div>
    
    <div style="margin-top: 20px;">
        <h3>Método 3: Criar elemento style inline</h3>
        <button onclick="metodo3('padrao')">Padrão</button>
        <button onclick="metodo3('azul')">Azul</button>
        <button onclick="metodo3('verde')">Verde</button>
        <button onclick="metodo3('roxo')">Roxo</button>
    </div>
    
    <div style="margin-top: 20px;">
        <h3>Botões para teste:</h3>
        <button class="btn">Botão Primário</button>
        <button class="btn">Botão Secundário</button>
    </div>
    
    <div style="margin-top: 20px;">
        <h3>Informações de depuração:</h3>
        <p>URL do CSS: <span id="css-url"></span></p>
        <p>Status: <span id="status">Aguardando ação...</span></p>
    </div>

    <script>
        // Atualiza a URL exibida quando a página carrega
        document.addEventListener('DOMContentLoaded', function() {
            atualizarInfoCSS();
        });
        
        // Método 1: Atualizar href do link existente
        function metodo1(tema) {
            atualizarStatus('Método 1: Atualizando href...');
            
            const temaLink = document.getElementById('tema-css');
            if (temaLink) {
                const timestamp = new Date().getTime();
                const novoHref = `css/tema_${tema}.css?v=${timestamp}`;
                
                temaLink.href = novoHref;
                document.getElementById('tema-atual').textContent = tema;
                
                atualizarInfoCSS();
                atualizarStatus('Método 1: Concluído');
                
                // Força reflow após um pequeno atraso
                setTimeout(forcarReflow, 100);
            }
        }
        
        // Método 2: Remover e adicionar novo link
        function metodo2(tema) {
            atualizarStatus('Método 2: Removendo e adicionando link...');
            
            const temaLink = document.getElementById('tema-css');
            if (temaLink) {
                const oldLink = temaLink;
                const newLink = document.createElement('link');
                newLink.id = 'tema-css';
                newLink.rel = 'stylesheet';
                newLink.type = 'text/css';
                
                const timestamp = new Date().getTime();
                newLink.href = `css/tema_${tema}.css?v=${timestamp}`;
                
                newLink.onload = function() {
                    atualizarStatus('Método 2: CSS carregado com sucesso');
                };
                newLink.onerror = function() {
                    atualizarStatus('Método 2: Erro ao carregar CSS');
                };
                
                oldLink.parentNode.replaceChild(newLink, oldLink);
                document.getElementById('tema-atual').textContent = tema;
                
                atualizarInfoCSS();
                
                // Força reflow após um pequeno atraso
                setTimeout(forcarReflow, 100);
            }
        }
        
        // Método 3: Criar elemento style inline
        function metodo3(tema) {
            atualizarStatus('Método 3: Criando style inline...');
            
            // Remove style inline anterior, se existir
            const estiloAnterior = document.getElementById('estilo-inline');
            if (estiloAnterior) {
                estiloAnterior.remove();
            }
            
            // Cria novo elemento style
            const estilo = document.createElement('style');
            estilo.id = 'estilo-inline';
            
            // Define as variáveis CSS com base no tema
            let cssVars = '';
            switch(tema) {
                case 'azul':
                    cssVars = `
                        :root {
                            --cor-primaria: #2980b9;
                            --cor-primaria-escura: #1c5a8a;
                            --cor-secundaria: #3498db;
                            --cor-secundaria-escura: #217dbb;
                        }
                    `;
                    break;
                case 'verde':
                    cssVars = `
                        :root {
                            --cor-primaria: #27ae60;
                            --cor-primaria-escura: #219653;
                            --cor-secundaria: #2ecc71;
                            --cor-secundaria-escura: #25a25a;
                        }
                    `;
                    break;
                case 'roxo':
                    cssVars = `
                        :root {
                            --cor-primaria: #8e44ad;
                            --cor-primaria-escura: #6c3483;
                            --cor-secundaria: #9b59b6;
                            --cor-secundaria-escura: #7d3c98;
                        }
                    `;
                    break;
                case 'padrao':
                default:
                    cssVars = `
                        :root {
                            --cor-primaria: #124a80;
                            --cor-primaria-escura: #0e3a66;
                            --cor-secundaria: #28a745;
                            --cor-secundaria-escura: #218838;
                        }
                    `;
                    break;
            }
            
            estilo.textContent = cssVars;
            document.head.appendChild(estilo);
            
            document.getElementById('tema-atual').textContent = tema;
            atualizarInfoCSS();
            atualizarStatus('Método 3: Concluído');
            
            // Força reflow
            forcarReflow();
        }
        
        // Função para forçar reflow
        function forcarReflow() {
            document.body.style.display = 'none';
            document.body.offsetHeight; // Trigger reflow
            document.body.style.display = 'block';
        }
        
        // Função para atualizar informações do CSS
        function atualizarInfoCSS() {
            const temaLink = document.getElementById('tema-css');
            if (temaLink) {
                document.getElementById('css-url').textContent = temaLink.href;
            }
        }
        
        // Função para atualizar status
        function atualizarStatus(mensagem) {
            document.getElementById('status').textContent = mensagem;
        }
    </script>
</body>
</html>